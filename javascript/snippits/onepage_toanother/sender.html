<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sender Page</title>
</head>
<body>
<h2>Sender Page</h2>
<form class="forms">
    Name: <input type="text" name="fname" id="fname"><br><br>
    Image: <input type="file" name="image" id="image"><br><br>
    <button type="submit">Submit</button> 
</form>

<script>
const form = document.querySelector('.forms');
const imageInput = document.getElementById('image');

form.addEventListener('submit', function(e){
    e.preventDefault();

    const name = document.querySelector('#fname').value;
    const file = imageInput.files[0];

    if(!file){
        alert('Please select an image!');
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e){
        const img = new Image();
        img.src = e.target.result;

        img.onload = function(){
            // Resize image using canvas
            const canvas = document.createElement('canvas');
            const MAX_WIDTH = 200;
            const MAX_HEIGHT = 200;
            let width = img.width;
            let height = img.height;

            if(width > height){
                if(width > MAX_WIDTH){
                    height *= MAX_WIDTH / width;
                    width = MAX_WIDTH;
                }
            } else {
                if(height > MAX_HEIGHT){
                    width *= MAX_HEIGHT / height;
                    height = MAX_HEIGHT;
                }
            }

            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);

            const dataURL = canvas.toDataURL('image/jpeg', 0.7); // compress image
            const data = {
                name: name,
                image: dataURL
            };

            // Store in localStorage
            try {
                localStorage.setItem('formData', JSON.stringify(data));
                window.location.href = './receiver.html';
            } catch (err) {
                alert('Image is too large to store. Please select a smaller image.');
            }
        }
    }
    reader.readAsDataURL(file);
});
</script>
</body>
</html>
